---
title: "IGC2"
author: "Yixuan Yang"
date: "6/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DT)
library(dplyr)
library(rlist)
library(stringr)
source("ReadinUnit.R")
```

```{r}

getList <- function(directory){
  cwd <- getwd()
  ListOutput = c()
  for(i in c(1:5588)){
    path = paste(cwd,"/inputfiles/",directory,"/",i,"/save/MG94_01_02_nonclockqq_summary.txt", sep = "")
    file = file.exists(path)
    if(file == TRUE){
      ListOutput = append(ListOutput,paste("MG",as.character(i),sep=""))
    }
  }
  
  return(ListOutput)
}
List2 = getList("IGC2_Full_noforce_noclock")

```

```{r Readin Unit}
IGC2Read <- function(number,directory) {
  cwd <- getwd()
  path = paste(cwd, "/inputFiles/",directory,"/", number, "/save/MG94_01_02_nonclockqq_summary.txt", sep = "")
  file = file.exists(path)
  if(file == TRUE){
    v <- scan(path, what = character())
    splitPoint = (length(v) - 1)/2
    value <- as.numeric(v[1:splitPoint])
    names <- v[(splitPoint + 2):length(v)]
    names(value) <- names
    return(value)
  }
  else{
    print("no such file")
  }
}

ListFunction <- function(cases, directory,option) {
  if(option == "List"){
    output = list()
    for(case in cases) {
      name = case
      number = substr(case, start=3, stop = nchar(case))
      data <- IGC2Read(number, directory)
      output[[name]]<- data
    }
    return(output)
  }
  if(option == "Matrix"){
    output = c()
    for(case in cases) {
      name = case
      number = substr(case, start=3, stop = nchar(case))
      data <- IGC2Read(number, directory)
      output = append(output,data)
    }
    output = matrix(output, ncol = length(cases))
    return(output) 
  }
}
```

```{r}
IGC2_Full_noforce_noclock <- ListFunction(List2, "IGC2_Full_noforce_noclock","List")
List2
```

```{r}
# matrix of general parameters
gp = c()
for(i in List2){
  vector = IGC2_Full_noforce_noclock[[i]][1:9]
  gp = rbind(gp,IGC2_Full_noforce_noclock[[i]][c(1,2,9)])
}
rownames(gp) <- restList(List2)
gp <- data.frame(gp)
datatable(gp)

```



```{r}
# Calculate proportion
#IGC2_Full_noforce_noclock[[1]]
proportionSep <- function(case){
  
    namelist <- names(IGC2_Full_noforce_noclock[[case]])
    one2two <- c()
    two2one <- c()
    mut <- c()
    for(i in namelist){
      if(str_detect(i,"1->2")){
        if (str_detect(i,"N0")==FALSE){
          one2two <- append(one2two,i)
        }
      }
    }
    for(i in namelist){
      if(str_detect(i,"2->1")){
        if (str_detect(i,"N0")==FALSE){
          two2one <- append(two2one,i)
        }
      }
    }
    for(i in namelist){
      if(str_detect(i,"mut")){
        if (str_detect(i,"N0")==FALSE){
          mut <- append(mut,i)
        }
      }
    }
    one2twoSum <- IGC2_Full_noforce_noclock[[case]][one2two]
    two2oneSum <- IGC2_Full_noforce_noclock[[case]][two2one]
    mutSum <- IGC2_Full_noforce_noclock[[case]][mut]
    num <- sum(one2twoSum, two2oneSum)
    den <- sum(one2twoSum, two2oneSum, mutSum)
    p = num/den
    return(p)
}

proportionWhole <- function(cases){
  out = c()
  for(case in cases){
    out = append(out, c(case, proportionSep(case)))
  }
  return(out)
}
#cases = restList(List2)
raw <-matrix(proportionWhole(List2), byrow = TRUE, ncol = 2)

proportion_IGC2 <- as.numeric(raw[,2])
names(proportion_IGC2) <- raw[,1]

```


```{r}
sort(proportion_IGC2)
datatable(data.frame(proportion_IGC2))
```
```{r}
omega = c()
for(i in List2){
  value <- IGC2_Full_noforce_noclock[[i]][8]
  names(value) <- i
  omega = append(omega,value)
}
plot(omega,proportion_IGC2)
cor(omega,proportion_IGC2)
s = lm(proportion_IGC2~omega)
abline(s)
```
```{r}
IGC2_Swap_noforce_clock <- ListFunction(List2, "IGC2_Swap_noforce_clock","List")
IGC2_Swap_noforce_clock
```

